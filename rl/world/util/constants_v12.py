from collections import OrderedDict

N_ACTIONS = 2312
STATE_SIZE_GLOBAL = 212
STATE_SIZE_ONE_PLAYER = 514
STATE_SIZE_ONE_HEX = 298

GLOBAL_ATTR_MAP = OrderedDict([
    ('BATTLE_SIDE', ('CATEGORICAL_STRICT_NULL', 0, 2, 1, -1.0)),
    ('BATTLE_SIDE_ACTIVE_PLAYER', ('CATEGORICAL_EXPLICIT_NULL', 2, 3, 1, -1.0)),
    ('BATTLE_WINNER', ('CATEGORICAL_EXPLICIT_NULL', 5, 3, 1, -1.0)),
    ('BFIELD_VALUE_START_ABS', ('EXPBIN_STRICT_NULL', 8, 50, 10000000, 7.5)),
    ('BFIELD_VALUE_NOW_ABS', ('EXPBIN_STRICT_NULL', 58, 50, 10000000, 7.5)),
    ('BFIELD_VALUE_NOW_REL0', ('LINNORM_STRICT_NULL', 108, 1, 1000, -1.0)),
    ('BFIELD_HP_START_ABS', ('EXPBIN_STRICT_NULL', 109, 50, 200000, 7.5)),
    ('BFIELD_HP_NOW_ABS', ('EXPBIN_STRICT_NULL', 159, 50, 200000, 7.5)),
    ('BFIELD_HP_NOW_REL0', ('LINNORM_STRICT_NULL', 209, 1, 1000, -1.0)),
    ('ACTION_MASK', ('BINARY_STRICT_NULL', 210, 2, 3, -1.0))
])

PLAYER_ATTR_MAP = OrderedDict([
    ('BATTLE_SIDE', ('CATEGORICAL_STRICT_NULL', 0, 2, 1, -1.0)),
    ('ARMY_VALUE_NOW_ABS', ('EXPBIN_STRICT_NULL', 2, 50, 10000000, 7.5)),
    ('ARMY_VALUE_NOW_REL', ('LINNORM_STRICT_NULL', 52, 1, 1000, -1.0)),
    ('ARMY_VALUE_NOW_REL0', ('LINNORM_STRICT_NULL', 53, 1, 1000, -1.0)),
    ('ARMY_HP_NOW_ABS', ('EXPBIN_STRICT_NULL', 54, 50, 200000, 7.5)),
    ('ARMY_HP_NOW_REL', ('LINNORM_STRICT_NULL', 104, 1, 1000, -1.0)),
    ('ARMY_HP_NOW_REL0', ('LINNORM_STRICT_NULL', 105, 1, 1000, -1.0)),
    ('VALUE_KILLED_NOW_ABS', ('EXPBIN_STRICT_NULL', 106, 50, 2000000, 7.5)),
    ('VALUE_KILLED_NOW_REL', ('LINNORM_STRICT_NULL', 156, 1, 1000, -1.0)),
    ('VALUE_KILLED_ACC_ABS', ('EXPBIN_STRICT_NULL', 157, 50, 10000000, 7.5)),
    ('VALUE_KILLED_ACC_REL0', ('LINNORM_STRICT_NULL', 207, 1, 1000, -1.0)),
    ('VALUE_LOST_NOW_ABS', ('EXPBIN_STRICT_NULL', 208, 50, 2000000, 7.5)),
    ('VALUE_LOST_NOW_REL', ('LINNORM_STRICT_NULL', 258, 1, 1000, -1.0)),
    ('VALUE_LOST_ACC_ABS', ('EXPBIN_STRICT_NULL', 259, 50, 10000000, 7.5)),
    ('VALUE_LOST_ACC_REL0', ('LINNORM_STRICT_NULL', 309, 1, 1000, -1.0)),
    ('DMG_DEALT_NOW_ABS', ('EXPBIN_STRICT_NULL', 310, 50, 20000, 7.5)),
    ('DMG_DEALT_NOW_REL', ('LINNORM_STRICT_NULL', 360, 1, 1000, -1.0)),
    ('DMG_DEALT_ACC_ABS', ('EXPBIN_STRICT_NULL', 361, 50, 200000, 7.5)),
    ('DMG_DEALT_ACC_REL0', ('LINNORM_STRICT_NULL', 411, 1, 1000, -1.0)),
    ('DMG_RECEIVED_NOW_ABS', ('EXPBIN_STRICT_NULL', 412, 50, 20000, 7.5)),
    ('DMG_RECEIVED_NOW_REL', ('LINNORM_STRICT_NULL', 462, 1, 1000, -1.0)),
    ('DMG_RECEIVED_ACC_ABS', ('EXPBIN_STRICT_NULL', 463, 50, 200000, 7.5)),
    ('DMG_RECEIVED_ACC_REL0', ('LINNORM_STRICT_NULL', 513, 1, 1000, -1.0))
])


HEX_ATTR_MAP = OrderedDict([
    ('Y_COORD', ('CATEGORICAL_STRICT_NULL', 0, 11, 10, -1.0)),
    ('X_COORD', ('CATEGORICAL_STRICT_NULL', 11, 15, 14, -1.0)),
    ('STATE_MASK', ('BINARY_STRICT_NULL', 26, 4, 15, -1.0)),
    ('ACTION_MASK', ('BINARY_ZERO_NULL', 30, 14, 16383, -1.0)),
    ('IS_REAR', ('CATEGORICAL_EXPLICIT_NULL', 44, 3, 1, -1.0)),
    ('STACK_SIDE', ('CATEGORICAL_EXPLICIT_NULL', 47, 3, 1, -1.0)),
    ('STACK_SLOT', ('CATEGORICAL_EXPLICIT_NULL', 50, 10, 8, -1.0)),
    ('STACK_QUANTITY', ('EXPBIN_ZERO_NULL', 60, 25, 1500, 6.5)),
    ('STACK_ATTACK', ('LINBIN_EXPLICIT_NULL', 85, 14, 60, 5.0)),
    ('STACK_DEFENSE', ('LINBIN_EXPLICIT_NULL', 99, 14, 60, 5.0)),
    ('STACK_SHOTS', ('EXPNORM_ZERO_NULL', 113, 1, 32, -1.0)),
    ('STACK_DMG_MIN', ('EXPBIN_EXPLICIT_NULL', 114, 16, 80, 3.3)),
    ('STACK_DMG_MAX', ('EXPBIN_EXPLICIT_NULL', 130, 16, 80, 3.3)),
    ('STACK_HP', ('EXPBIN_ZERO_NULL', 146, 18, 1000, 6.0)),
    ('STACK_HP_LEFT', ('LINNORM_EXPLICIT_NULL', 164, 2, 1000, -1.0)),
    ('STACK_SPEED', ('CATEGORICAL_EXPLICIT_NULL', 166, 20, 18, -1.0)),
    ('STACK_QUEUE', ('BINARY_ZERO_NULL', 186, 30, 1073741823, -1.0)),
    ('STACK_VALUE_ONE', ('EXPBIN_ZERO_NULL', 216, 20, 80000, 6.5)),
    ('STACK_FLAGS1', ('BINARY_EXPLICIT_NULL', 236, 26, 33554431, -1.0)),
    ('STACK_FLAGS2', ('BINARY_EXPLICIT_NULL', 262, 16, 32767, -1.0)),
    ('STACK_VALUE_REL', ('LINNORM_EXPLICIT_NULL', 278, 2, 1000, -1.0)),
    ('STACK_VALUE_REL0', ('LINNORM_EXPLICIT_NULL', 280, 2, 1000, -1.0)),
    ('STACK_VALUE_KILLED_REL', ('LINNORM_EXPLICIT_NULL', 282, 2, 1000, -1.0)),
    ('STACK_VALUE_KILLED_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 284, 2, 1000, -1.0)),
    ('STACK_VALUE_LOST_REL', ('LINNORM_EXPLICIT_NULL', 286, 2, 1000, -1.0)),
    ('STACK_VALUE_LOST_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 288, 2, 1000, -1.0)),
    ('STACK_DMG_DEALT_REL', ('LINNORM_EXPLICIT_NULL', 290, 2, 1000, -1.0)),
    ('STACK_DMG_DEALT_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 292, 2, 1000, -1.0)),
    ('STACK_DMG_RECEIVED_REL', ('LINNORM_EXPLICIT_NULL', 294, 2, 1000, -1.0)),
    ('STACK_DMG_RECEIVED_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 296, 2, 1000, -1.0))
])

HEX_ACT_MAP = OrderedDict([
    ('AMOVE_TR', 0),
    ('AMOVE_R', 1),
    ('AMOVE_BR', 2),
    ('AMOVE_BL', 3),
    ('AMOVE_L', 4),
    ('AMOVE_TL', 5),
    ('AMOVE_2TR', 6),
    ('AMOVE_2R', 7),
    ('AMOVE_2BR', 8),
    ('AMOVE_2BL', 9),
    ('AMOVE_2L', 10),
    ('AMOVE_2TL', 11),
    ('MOVE', 12),
    ('SHOOT', 13)
])

# Helper constants for reconstructing obs/mask
STATE_HEXES_INDEX_START = STATE_SIZE_GLOBAL + 2*STATE_SIZE_ONE_PLAYER
HEX_MASK_INDEX_START = HEX_ATTR_MAP["ACTION_MASK"][1]
HEX_MASK_INDEX_END = HEX_MASK_INDEX_START + HEX_ATTR_MAP["ACTION_MASK"][2]
