from collections import OrderedDict

N_ACTIONS = 2312
STATE_SIZE_GLOBAL = 16
STATE_SIZE_ONE_PLAYER = 24
STATE_SIZE_ONE_HEX = 164

GLOBAL_ATTR_MAP = OrderedDict([
    ('BATTLE_SIDE', ('CATEGORICAL_STRICT_NULL', 0, 2, 1)),
    ('BATTLE_SIDE_ACTIVE_PLAYER', ('CATEGORICAL_EXPLICIT_NULL', 2, 3, 1)),
    ('BATTLE_WINNER', ('CATEGORICAL_EXPLICIT_NULL', 5, 3, 1)),
    ('BFIELD_VALUE_START_ABS', ('EXPNORM_STRICT_NULL', 8, 1, 10000000)),
    ('BFIELD_VALUE_NOW_ABS', ('EXPNORM_STRICT_NULL', 9, 1, 10000000)),
    ('BFIELD_VALUE_NOW_REL0', ('LINNORM_STRICT_NULL', 10, 1, 1000)),
    ('BFIELD_HP_START_ABS', ('EXPNORM_STRICT_NULL', 11, 1, 200000)),
    ('BFIELD_HP_NOW_ABS', ('EXPNORM_STRICT_NULL', 12, 1, 200000)),
    ('BFIELD_HP_NOW_REL0', ('LINNORM_STRICT_NULL', 13, 1, 1000)),
    ('ACTION_MASK', ('BINARY_STRICT_NULL', 14, 2, 3))
])

PLAYER_ATTR_MAP = OrderedDict([
    ('BATTLE_SIDE', ('CATEGORICAL_STRICT_NULL', 0, 2, 1)),
    ('ARMY_VALUE_NOW_ABS', ('EXPNORM_STRICT_NULL', 2, 1, 5000000)),
    ('ARMY_VALUE_NOW_REL', ('LINNORM_STRICT_NULL', 3, 1, 1000)),
    ('ARMY_VALUE_NOW_REL0', ('LINNORM_STRICT_NULL', 4, 1, 1000)),
    ('ARMY_HP_NOW_ABS', ('EXPNORM_STRICT_NULL', 5, 1, 100000)),
    ('ARMY_HP_NOW_REL', ('LINNORM_STRICT_NULL', 6, 1, 1000)),
    ('ARMY_HP_NOW_REL0', ('LINNORM_STRICT_NULL', 7, 1, 1000)),
    ('VALUE_KILLED_NOW_ABS', ('EXPNORM_STRICT_NULL', 8, 1, 5000000)),
    ('VALUE_KILLED_NOW_REL', ('LINNORM_STRICT_NULL', 9, 1, 1000)),
    ('VALUE_KILLED_ACC_ABS', ('EXPNORM_STRICT_NULL', 10, 1, 5000000)),
    ('VALUE_KILLED_ACC_REL0', ('LINNORM_STRICT_NULL', 11, 1, 1000)),
    ('VALUE_LOST_NOW_ABS', ('EXPNORM_STRICT_NULL', 12, 1, 5000000)),
    ('VALUE_LOST_NOW_REL', ('LINNORM_STRICT_NULL', 13, 1, 1000)),
    ('VALUE_LOST_ACC_ABS', ('EXPNORM_STRICT_NULL', 14, 1, 5000000)),
    ('VALUE_LOST_ACC_REL0', ('LINNORM_STRICT_NULL', 15, 1, 1000)),
    ('DMG_DEALT_NOW_ABS', ('EXPNORM_STRICT_NULL', 16, 1, 10000)),
    ('DMG_DEALT_NOW_REL', ('LINNORM_STRICT_NULL', 17, 1, 1000)),
    ('DMG_DEALT_ACC_ABS', ('EXPNORM_STRICT_NULL', 18, 1, 100000)),
    ('DMG_DEALT_ACC_REL0', ('LINNORM_STRICT_NULL', 19, 1, 1000)),
    ('DMG_RECEIVED_NOW_ABS', ('EXPNORM_STRICT_NULL', 20, 1, 10000)),
    ('DMG_RECEIVED_NOW_REL', ('LINNORM_STRICT_NULL', 21, 1, 1000)),
    ('DMG_RECEIVED_ACC_ABS', ('EXPNORM_STRICT_NULL', 22, 1, 100000)),
    ('DMG_RECEIVED_ACC_REL0', ('LINNORM_STRICT_NULL', 23, 1, 1000))
])

HEX_ATTR_MAP = OrderedDict([
    ('Y_COORD', ('CATEGORICAL_STRICT_NULL', 0, 11, 10)),
    ('X_COORD', ('CATEGORICAL_STRICT_NULL', 11, 15, 14)),
    ('STATE_MASK', ('BINARY_STRICT_NULL', 26, 4, 15)),
    ('ACTION_MASK', ('BINARY_ZERO_NULL', 30, 14, 16383)),
    ('IS_REAR', ('CATEGORICAL_EXPLICIT_NULL', 44, 3, 1)),
    ('STACK_SIDE', ('CATEGORICAL_EXPLICIT_NULL', 47, 3, 1)),
    ('STACK_SLOT', ('CATEGORICAL_EXPLICIT_NULL', 50, 10, 8)),
    ('STACK_QUANTITY', ('EXPNORM_EXPLICIT_NULL', 60, 2, 1500)),
    ('STACK_ATTACK', ('EXPNORM_ZERO_NULL', 62, 1, 80)),
    ('STACK_DEFENSE', ('EXPNORM_ZERO_NULL', 63, 1, 80)),
    ('STACK_SHOTS', ('EXPNORM_ZERO_NULL', 64, 1, 32)),
    ('STACK_DMG_MIN', ('EXPNORM_ZERO_NULL', 65, 1, 100)),
    ('STACK_DMG_MAX', ('EXPNORM_ZERO_NULL', 66, 1, 100)),
    ('STACK_HP', ('EXPNORM_ZERO_NULL', 67, 1, 1300)),
    ('STACK_HP_LEFT', ('EXPNORM_ZERO_NULL', 68, 1, 1300)),
    ('STACK_SPEED', ('EXPNORM_ZERO_NULL', 69, 1, 30)),
    ('STACK_QUEUE', ('BINARY_ZERO_NULL', 70, 30, 1073741823)),
    ('STACK_VALUE_ONE', ('EXPNORM_EXPLICIT_NULL', 100, 2, 180000)),
    ('STACK_FLAGS1', ('BINARY_EXPLICIT_NULL', 102, 26, 33554431)),
    ('STACK_FLAGS2', ('BINARY_EXPLICIT_NULL', 128, 16, 32767)),
    ('STACK_VALUE_REL', ('LINNORM_EXPLICIT_NULL', 144, 2, 1000)),
    ('STACK_VALUE_REL0', ('LINNORM_EXPLICIT_NULL', 146, 2, 1000)),
    ('STACK_VALUE_KILLED_REL', ('LINNORM_EXPLICIT_NULL', 148, 2, 1000)),
    ('STACK_VALUE_KILLED_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 150, 2, 1000)),
    ('STACK_VALUE_LOST_REL', ('LINNORM_EXPLICIT_NULL', 152, 2, 1000)),
    ('STACK_VALUE_LOST_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 154, 2, 1000)),
    ('STACK_DMG_DEALT_REL', ('LINNORM_EXPLICIT_NULL', 156, 2, 1000)),
    ('STACK_DMG_DEALT_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 158, 2, 1000)),
    ('STACK_DMG_RECEIVED_REL', ('LINNORM_EXPLICIT_NULL', 160, 2, 1000)),
    ('STACK_DMG_RECEIVED_ACC_REL0', ('LINNORM_EXPLICIT_NULL', 162, 2, 1000))
])

HEX_ACT_MAP = OrderedDict([
    ('AMOVE_TR', 0),
    ('AMOVE_R', 1),
    ('AMOVE_BR', 2),
    ('AMOVE_BL', 3),
    ('AMOVE_L', 4),
    ('AMOVE_TL', 5),
    ('AMOVE_2TR', 6),
    ('AMOVE_2R', 7),
    ('AMOVE_2BR', 8),
    ('AMOVE_2BL', 9),
    ('AMOVE_2L', 10),
    ('AMOVE_2TL', 11),
    ('MOVE', 12),
    ('SHOOT', 13)
])

# Helper constants for reconstructing obs/mask
STATE_HEXES_INDEX_START = STATE_SIZE_GLOBAL + 2*STATE_SIZE_ONE_PLAYER
HEX_MASK_INDEX_START = HEX_ATTR_MAP["ACTION_MASK"][1]
HEX_MASK_INDEX_END = HEX_MASK_INDEX_START + HEX_ATTR_MAP["ACTION_MASK"][2]
